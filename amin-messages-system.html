<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ - Ø£Ù…ÙŠÙ† Ù†Ø§Ø¬Ø­</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #667eea;
            --primary-dark: #764ba2;
            --emergency: #e74c3c;
            --success: #27ae60;
            --whatsapp: #25D366;
            --warning: #f39c12;
            --text: #2c3e50;
            --text-light: #7f8c8d;
            --bg: #f8f9fa;
            --white: #ffffff;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            min-height: 100vh;
            color: var(--text);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .message-form, .contacts-panel {
            background: var(--white);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text);
        }
        
        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-emergency {
            background: var(--emergency);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .contacts-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .contact-item, .message-item {
            background: var(--bg);
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-right: 4px solid var(--primary);
        }
        
        .contact-item.emergency {
            border-right-color: var(--emergency);
        }
        
        .contact-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .contact-name {
            font-weight: bold;
            color: var(--text);
        }
        
        .contact-phone {
            color: var(--primary);
            font-weight: 600;
        }
        
        .contact-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-light);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 10px;
            color: white;
            z-index: 10000;
            animation: slideInRight 0.3s ease-out;
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--emergency);
        }
        
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: var(--white);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }
        
        .stat-label {
            color: var(--text-light);
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
        <header class="header">
            <h1>ğŸ“¨ Ù†Ø¸Ø§Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</h1>
            <p>Ø§Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø© ÙˆØ³Ø£Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙˆØ±Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ</p>
        </header>

        <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
        <div class="stats-grid" id="statsContainer">
            <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
        </div>

        <!-- Ø§Ù„Ø´Ø¨ÙƒØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
        <div class="main-grid">
            <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø© -->
            <div class="message-form">
                <h2 style="margin-bottom: 25px; color: var(--text);">ğŸ“ Ø£Ø±Ø³Ù„ Ø±Ø³Ø§Ù„Ø©</h2>
                
                <form id="messageForm">
                    <div class="form-group">
                        <label for="name">ğŸ‘¤ Ø§Ø³Ù…Ùƒ</label>
                        <input type="text" id="name" class="form-control" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" id="phone" class="form-control" required placeholder="01153546426">
                    </div>
                    
                    <div class="form-group">
                        <label for="email">ğŸ“§ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                        <input type="email" id="email" class="form-control" placeholder="amin.weqena2@gmail.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="messageType">ğŸ·ï¸ Ù†ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <select id="messageType" class="form-control">
                            <option value="general">Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ø§Ù…</option>
                            <option value="emergency">Ø·ÙˆØ§Ø±Ø¦</option>
                            <option value="project">Ù…Ø´Ø±ÙˆØ¹</option>
                            <option value="support">Ø¯Ø¹Ù… ÙÙ†ÙŠ</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="subject">ğŸ“‹ Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <input type="text" id="subject" class="form-control" required placeholder="Ù…ÙˆØ¶ÙˆØ¹ Ø§Ù„Ø±Ø³Ø§Ù„Ø©">
                    </div>
                    
                    <div class="form-group">
                        <label for="message">ğŸ’¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©</label>
                        <textarea id="message" class="form-control" required placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ù‡Ù†Ø§..."></textarea>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-paper-plane"></i>
                        Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
                    </button>
                    
                    <button type="button" onclick="sendEmergency()" class="btn btn-emergency" style="width: 100%; margin-top: 10px;">
                        <i class="fas fa-bell"></i>
                        ğŸš¨ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø·ÙˆØ§Ø±Ø¦
                    </button>
                </form>
            </div>

            <!-- Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ -->
            <div class="contacts-panel">
                <h2 style="margin-bottom: 25px; color: var(--text);">ğŸ“¨ Ø¢Ø®Ø± Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</h2>
                
                <div class="contacts-list" id="messagesList">
                    <!-- Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
                </div>
                
                <button onclick="loadMessages()" class="btn btn-success" style="width: 100%; margin-top: 15px;">
                    <i class="fas fa-sync"></i>
                    ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000/api';
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 4000);
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        async function loadStats() {
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const data = await response.json();
                
                if (data.success) {
                    const stats = data.stats;
                    const statsHTML = `
                        <div class="stat-card">
                            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„Ø§Øª</div>
                            <div class="stat-number">${stats.total_contacts}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</div>
                            <div class="stat-number">${stats.total_messages}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙŠÙˆÙ…</div>
                            <div class="stat-number">${stats.today_messages}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø­Ø§Ù„Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</div>
                            <div class="stat-number">${stats.emergency_count}</div>
                        </div>
                    `;
                    
                    document.getElementById('statsContainer').innerHTML = statsHTML;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
        async function loadMessages() {
            try {
                const response = await fetch(`${API_BASE}/messages`);
                const data = await response.json();
                
                if (data.success) {
                    const messages = data.messages.slice(-10).reverse(); // Ø¢Ø®Ø± 10 Ø±Ø³Ø§Ø¦Ù„
                    const messagesHTML = messages.map(msg => `
                        <div class="message-item ${msg.type === 'emergency' ? 'emergency' : ''}">
                            <div class="contact-header">
                                <span class="contact-name">${msg.name}</span>
                                <span class="contact-phone">${msg.phone}</span>
                            </div>
                            <div style="margin: 8px 0; color: var(--text);">
                                <strong>${msg.subject}</strong>
                                <p style="margin: 5px 0; font-size: 14px;">${msg.message}</p>
                            </div>
                            <div class="contact-meta">
                                <span>${msg.type}</span>
                                <span>${msg.date.split(' ')[1]}</span>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('messagesList').innerHTML = messagesHTML || '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯</p>';
                }
            } catch (error) {
                console.error('Error loading messages:', error);
                document.getElementById('messagesList').innerHTML = '<p>Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„</p>';
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø±Ø³Ø§Ù„Ø©
        async function sendMessage(messageData) {
            try {
                const response = await fetch(`${API_BASE}/send-message`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(messageData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('âœ… ' + data.message, 'success');
                    loadMessages();
                    loadStats();
                    document.getElementById('messageForm').reset();
                } else {
                    showNotification('âŒ ' + data.message, 'error');
                }
            } catch (error) {
                console.error('Error sending message:', error);
                showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„', 'error');
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø·ÙˆØ§Ø±Ø¦
        async function sendEmergency() {
            const name = document.getElementById('name').value || 'Ù…Ø³ØªØ®Ø¯Ù…';
            const phone = document.getElementById('phone').value || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
            
            if (!phone || phone === 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ') {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            if (confirm('ğŸš¨ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ø·ÙˆØ§Ø±Ø¦ØŸ')) {
                try {
                    const response = await fetch(`${API_BASE}/emergency-alert`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            name: name,
                            phone: phone,
                            type: 'Ø·ÙˆØ§Ø±Ø¦ Ø¹Ø§Ø¬Ù„Ø©',
                            location: 'ÙŠØªÙ… ØªØ­Ø¯ÙŠØ¯Ù‡...'
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.success) {
                        showNotification('ğŸš¨ ' + data.message, 'success');
                        // Ø§ØªØµØ§Ù„ ÙÙˆØ±ÙŠ
                        window.open(`tel:01153546426`, '_self');
                    } else {
                        showNotification('âŒ ' + data.message, 'error');
                    }
                } catch (error) {
                    console.error('Error sending emergency:', error);
                    showNotification('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡', 'error');
                }
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        document.getElementById('messageForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = {
                name: document.getElementById('name').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                messageType: document.getElementById('messageType').value,
                subject: document.getElementById('subject').value,
                message: document.getElementById('message').value
            };
            
            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            if (!formData.name || !formData.phone || !formData.subject || !formData.message) {
                showNotification('âŒ ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©', 'error');
                return;
            }
            
            sendMessage(formData);
        });
        
        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø©
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            loadMessages();
            
            // ØªØ­Ø¯ÙŠØ« ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
            setInterval(() => {
                loadStats();
                loadMessages();
            }, 30000);
        });
    </script>
</body>
</html>